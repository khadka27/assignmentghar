# Missing Verification Page - User Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     USER TRIES TO LOGIN                              â”‚
â”‚                   (with unverified account)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Login Failed  â”‚
                    â”‚ "Verify Email" â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                                 â”‚
            â–¼                                 â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ OPTION A:      â”‚              â”‚  OPTION B:       â”‚
   â”‚ Inline OTP     â”‚              â”‚  Redirect to     â”‚
   â”‚ (Current)      â”‚              â”‚  /missing-       â”‚
   â”‚                â”‚              â”‚   verification   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                               â”‚
            â”‚                               â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  MISSING VERIFICATION â”‚
            â”‚         PAGE          â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Enter Email Address  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Check Account Status  â”‚
            â”‚  (API Call to DB)     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
        â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NOT FOUND â”‚   â”‚  UNVERIFIED  â”‚  â”‚  VERIFIED   â”‚
â”‚  âŒ       â”‚   â”‚     âš ï¸       â”‚  â”‚    âœ…       â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚                â”‚                  â”‚
      â”‚                â”‚                  â”‚
      â–¼                â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚"Create   â”‚    â”‚"Send OTP"   â”‚   â”‚"Already      â”‚
â”‚ Account?"â”‚    â”‚   Button    â”‚   â”‚ Verified"    â”‚
â”‚          â”‚    â”‚             â”‚   â”‚              â”‚
â”‚ Yes | No â”‚    â”‚             â”‚   â”‚Auto Redirect â”‚
â””â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚    â”‚               â”‚                  â”‚
  â”‚    â”‚               â–¼                  â”‚
  â”‚    â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
  â”‚    â”‚        â”‚  OTP Sent   â”‚           â”‚
  â”‚    â”‚        â”‚ to Email    â”‚           â”‚
  â”‚    â”‚        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â”‚
  â”‚    â”‚               â”‚                  â”‚
  â”‚    â”‚               â–¼                  â”‚
  â”‚    â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
  â”‚    â”‚        â”‚ Enter 6-    â”‚           â”‚
  â”‚    â”‚        â”‚ Digit Code  â”‚           â”‚
  â”‚    â”‚        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â”‚
  â”‚    â”‚               â”‚                  â”‚
  â”‚    â”‚               â–¼                  â”‚
  â”‚    â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
  â”‚    â”‚        â”‚  Verify OTP â”‚           â”‚
  â”‚    â”‚        â”‚  (API Call) â”‚           â”‚
  â”‚    â”‚        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â”‚
  â”‚    â”‚               â”‚                  â”‚
  â”‚    â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”           â”‚
  â”‚    â”‚        â”‚   Success   â”‚           â”‚
  â”‚    â”‚        â”‚ isVerified= â”‚           â”‚
  â”‚    â”‚        â”‚    true     â”‚           â”‚
  â”‚    â”‚        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â”‚
  â”‚    â”‚               â”‚                  â”‚
  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚                    â”‚
  â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚/register â”‚    â”‚   /login    â”‚
â”‚  page    â”‚    â”‚    page     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Detailed State Flow

### **State 1: Checking** ğŸ”

```
User enters email â†’ System queries database
Display: Loading spinner
Wait for API response
```

### **State 2: Account Not Found** âŒ

```
API Response: { exists: false }
Display:
  - Red UserX icon
  - "Account Not Found" message
  - Email address shown
  - "Would you like to create an account?"
Actions:
  - [Yes, Create Account] â†’ /register
  - [No, Go to Login] â†’ /login
```

### **State 3: Account Unverified** âš ï¸

```
API Response: { exists: true, isVerified: false }
Display:
  - Yellow AlertCircle icon
  - "Email Not Verified" message
  - User's email address
  - "Send Verification Code" button
Actions:
  - Click button â†’ Send OTP to email
  - Transition to State 4
```

### **State 4: OTP Sent** ğŸ“§

```
After clicking "Send Verification Code"
Display:
  - Blue Mail icon
  - "Verify Your Email" heading
  - Email address confirmation
  - 6-digit OTP input field
  - "Verify Email" button
  - "Resend Code" button (with 60s timer)
  - "Back" button
Actions:
  - Enter OTP â†’ Click Verify
  - If correct â†’ Transition to State 5
  - If wrong â†’ Show error, allow retry
  - If expired â†’ Show error, use Resend
  - Click Back â†’ Return to State 3
```

### **State 5: Verified** âœ…

```
After successful OTP verification
Display:
  - Green CheckCircle icon
  - "Account Already Verified!" message
  - "Redirecting you to login..." text
  - Loading state
Actions:
  - Auto-redirect to /login after 2 seconds
  - User can now login successfully
```

---

## API Integration Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Frontend Components                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  missing-verification/page.tsx              â”‚
â”‚    â”‚                                        â”‚
â”‚    â”œâ”€â–º checkAccountStatus()                â”‚
â”‚    â”‚     â””â”€â–º POST /api/auth/               â”‚
â”‚    â”‚         check-account-status           â”‚
â”‚    â”‚                                        â”‚
â”‚    â”œâ”€â–º handleSendOTP()                     â”‚
â”‚    â”‚     â””â”€â–º POST /api/auth/resend-otp     â”‚
â”‚    â”‚                                        â”‚
â”‚    â””â”€â–º handleVerifyOTP()                   â”‚
â”‚          â””â”€â–º POST /api/auth/verify-otp     â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              API Routes                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  /api/auth/check-account-status/route.ts   â”‚
â”‚    â”œâ”€â–º Query: findUnique(email)            â”‚
â”‚    â””â”€â–º Return: exists, isVerified          â”‚
â”‚                                             â”‚
â”‚  /api/auth/resend-otp/route.ts             â”‚
â”‚    â”œâ”€â–º Generate 6-digit OTP                â”‚
â”‚    â”œâ”€â–º Save to DB (otp, otpExpiry)         â”‚
â”‚    â””â”€â–º Send email with OTP                 â”‚
â”‚                                             â”‚
â”‚  /api/auth/verify-otp/route.ts             â”‚
â”‚    â”œâ”€â–º Query: findUnique(email)            â”‚
â”‚    â”œâ”€â–º Check: otp match & not expired      â”‚
â”‚    â”œâ”€â–º Update: isVerified = true           â”‚
â”‚    â”œâ”€â–º Clear: otp, otpExpiry               â”‚
â”‚    â””â”€â–º Return: success                     â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Database (PostgreSQL)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  User Table:                                â”‚
â”‚    - id                                     â”‚
â”‚    - email                                  â”‚
â”‚    - password (hashed)                      â”‚
â”‚    - name                                   â”‚
â”‚    - isVerified (boolean)                   â”‚
â”‚    - emailVerified (DateTime)               â”‚
â”‚    - otp (String?)                          â”‚
â”‚    - otpExpiry (DateTime?)                  â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Timer System

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       OTP Resend Timer              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  Initial: resendTimer = 0           â”‚
â”‚                                     â”‚
â”‚  On Send OTP:                       â”‚
â”‚    setResendTimer(60)               â”‚
â”‚                                     â”‚
â”‚  useEffect Hook:                    â”‚
â”‚    if (resendTimer > 0) {           â”‚
â”‚      setTimeout(() => {             â”‚
â”‚        setResendTimer(              â”‚
â”‚          resendTimer - 1            â”‚
â”‚        )                            â”‚
â”‚      }, 1000)                       â”‚
â”‚    }                                â”‚
â”‚                                     â”‚
â”‚  Display:                           â”‚
â”‚    if resendTimer > 0:              â”‚
â”‚      "Resend in {resendTimer}s"     â”‚
â”‚      [Button Disabled]              â”‚
â”‚    else:                            â”‚
â”‚      "Resend Code"                  â”‚
â”‚      [Button Enabled]               â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Timeline:
60s â†’ 59s â†’ 58s â†’ ... â†’ 3s â†’ 2s â†’ 1s â†’ 0s
[â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Disabled â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€][Enabled]
```

---

## Error Handling

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Error Scenarios              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚ 1. Network Error                     â”‚
â”‚    â”œâ”€ Show: "Failed to connect"     â”‚
â”‚    â””â”€ Action: Retry button           â”‚
â”‚                                      â”‚
â”‚ 2. Invalid Email Format              â”‚
â”‚    â”œâ”€ Show: HTML5 validation         â”‚
â”‚    â””â”€ Action: Fix email              â”‚
â”‚                                      â”‚
â”‚ 3. OTP Expired                       â”‚
â”‚    â”œâ”€ Show: "Code expired"           â”‚
â”‚    â””â”€ Action: Resend OTP             â”‚
â”‚                                      â”‚
â”‚ 4. Wrong OTP                         â”‚
â”‚    â”œâ”€ Show: "Invalid code"           â”‚
â”‚    â””â”€ Action: Try again / Resend     â”‚
â”‚                                      â”‚
â”‚ 5. Email Sending Failed              â”‚
â”‚    â”œâ”€ Show: "Failed to send email"   â”‚
â”‚    â””â”€ Action: Check logs / Retry     â”‚
â”‚                                      â”‚
â”‚ 6. Database Error                    â”‚
â”‚    â”œâ”€ Show: "Server error"           â”‚
â”‚    â””â”€ Action: Contact support        â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Security Features

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Security Measures               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚ âœ… OTP Expiration (10 minutes)          â”‚
â”‚ âœ… Rate Limiting (60s between resends)  â”‚
â”‚ âœ… Email Validation (format check)      â”‚
â”‚ âœ… Case-insensitive email matching      â”‚
â”‚ âœ… No password in verification flow     â”‚
â”‚ âœ… Secure random OTP generation         â”‚
â”‚ âœ… Database-backed verification         â”‚
â”‚ âœ… No sensitive data in URLs            â”‚
â”‚ âœ… Toast notifications (no modal spam) â”‚
â”‚ âœ… Clear error messages                 â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
